{% extends "source/admin_base.html" %}

{% set controller = 'ckanext.harvest.controllers.view:ViewController' %}

{% block subtitle %}{{ _('Harvest Jobs')}} - {{ super() }}{% endblock %}

{% block primary_content_inner %}
<div class="module-content">

  <header class="with-filter">
    <ul class="nav nav-pills pull-right">
      <li class="disabled"><a>{{ _('Show me:') }}</a></li>
      <li{% if c.filter_nav == 'Finished' %} class="active"{% endif %}>{{ h.nav_named_link(_('Finished'), 'harvest_job_list', source=source.name) }}</li>
      <li{% if c.filter_nav == 'New' %} class="active"{% endif %}>{{ h.nav_named_link(_('New'), 'harvest_job_list', source=source.name, status='New') }}</li>
      <li{% if c.filter_nav == 'Running' %} class="active"{% endif %}>{{ h.nav_named_link(_('Running'), 'harvest_job_list', source=source.name, status='Running') }}</li>
    </ul>
    <h1>{{ _('Harvest Jobs') }}</h1>
  </header>

  {% if c.jobs|length == 0 %}
    <p class="empty">{{ _('No jobs yet for this source') }}</p>
  {% else %}
    <ul class="dataset-list unstyled">
      {% for job in c.jobs %}
        <li class="dataset-item">
          <div class="dataset-content">
            <h3 class="dataset-heading">
              <a href="{{ h.url_for(controller=controller, action='show_job', source=source.name, id=job.id) }}">
                {{ _('Job: ') }} {{ job.id }}
              </a>
            </h3>
              <p>
              {{ _('Started:') }} {{ h.render_datetime(job.gather_started, with_hours=True) or _('Not yet') }}
              &mdash;
              {{ _('Finished:') }} {{ h.render_datetime(job.gather_finished, with_hours=True) or _('Not yet') }}
            </p>
          </div>
          {% if job.status == 'Finished' %}
            <ul class="dataset-resources unstyled">
              {% if 'errored' in job.stats and job.stats['errored'] > 0 %}
                <li>
                  <span class="label label-important">
                    {{ job.stats['errored'] }} {{ _('errors') }}
                  </span>
                </li>
              {% endif %}
              {% for action in ['added', 'updated', 'deleted'] %}
                <li>
                  <span class="label" data-diff="{{ action }}" title="{{ _(action) }}">
                    {% if action in job.stats and job.stats[action] > 0 %}
                      {{ job.stats[action] }}
                    {% else %}
                      0
                    {% endif %}
                    {{ _(action) }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
       {% endfor %}
    </ul>
  {% endif %}

</div>
{% endblock %}
  
