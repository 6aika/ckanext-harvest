{#
Displays information for a particular harvest job, including:

  * counts for added, updated, deleted or errored datasets
  * table with general details
  * table with a summary of the most common errors on this job

job        - dictized harvest job object

Example:

  {% snippet 'snippets/job_details.html', job=job %}

#}

<p>GUID: <code>{{ job.id }}</code></p>

{% set stats = job.stats %}

<p class="pull-right">
  {% if 'errored' in stats and stats['errored'] > 0 %}
    <span class="badge badge-important">{{ stats['errored'] }}</span> {{ _('errors') }}
  {% else %}
    <span class="badge">0</span> {{ _('errors') }}
  {% endif %}
</p>

<p class="harvest-diff">
  {% for action in ['added', 'updated', 'deleted'] %}
    <span class="diff-{{ action }}">
      {% if action in stats and stats[action] > 0 %}
        {{ stats[action] }}
      {% else %}
        0
      {% endif %}
      {{ _(action) }}
    </span>
  {% endfor %}
</p>

<h3>{{ _('Details') }}</h3>
<table class="table table-striped table-bordered table-condensed">
  <colgroup>
    <col width="15">
    <col width="85">
  </colgroup>
  <tr>
    <th>{{ _('Started') }}</th>
    <td>{{ h.render_datetime(job.gather_started, with_hours=True) }}</td>
  </tr>
  <tr>
    <th>{{ _('Finished') }}</th>
    <td>{{ h.render_datetime(job.finished, with_hours=True) }}</td>
  </tr>
  <tr>
    <th>{{ _('Status') }}</th>
    <td>{{ _(job.status) }}</td>
  </tr>
</table>

<h3>{{ _('Error Summary') }}</h3>
{% if job.error_summary|length == 0 %}
  <p class="empty">{{ _('No errors for this job') }}</p>
{% else %}
  <p class="empty">{{ _('Only the 20 most frequent errors are shown') }}</p>
  <table class="table table-striped table-bordered table-condensed harvest-error-summary">
    <colgroup>
      <col width="8">
      <col width="92">
    </colgroup>
    <thead>
      <tr>
        <th class="count">{{ _('Count') }}</th>
        <th>{{ _('Message') }}</th>
      </tr>
    </thead>
    <tbody>
    {% for error in job.error_summary %}
      <tr>
        <td class="count">{{ error[1] }}</td>
        <td>{{ error[0] }}</td>
      </tr>
    {% endfor %}
     </tbody>
  </table>
{% endif %}
